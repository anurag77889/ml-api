# If someone sends POST or PUT /health
# FastAPI wil return 405 method not allowed

# 400 -> Client sent wrong data
# 500 -> Server failed internally

# FastAPI converts your Python dictionary into JSON
# before sending it to Uvicorn

# FastAPI = framework logic + serialization
# Uvicorn = ASGI server (network layer)

# Uvicorn is an ASGI server which listens on a port 8000,
# accepts HTTP requests, forwards them to FastAPI, sends back
# FastAPI's response

# If data is invalid, then 422 - Unprocessable Entity

# Incoming request 
# FastAPI parses JSON 
# Pydantic validates schema
# If valid -> function runs and ML Inference
# If invalid -> function never runs 

# without PredictionInput there will be no type validation
# no required field enforcement, no automatic conversion,
# which leads to more bugs so USE IT 

# NEVER train model inside request

# App starts -> Load trained model into memory
# Request -> Use model for inference -> Respond

# we return [[]] because scikit-learn expects 
# (number_of_samples, number_of_features)
# [[age, salary]] # [] => no.of samples, 
#                 # age and salary => no.of features


# Exposing raw errors could lead to file paths, internal logic
# stack traces, db structure which attackers love so 
# trust is secondary, security is primary

# Validation error usually happens before business logic, 
# often from client side, schema mismatch, 422 or 400 code

# Inference error usually happens inside business logic,
# from server side, model or feature process fail, 500 code 

# Logs should go to log files, logging services like ELK
# or centralized log aggregators

# ? in SQL is parameterized query which prevents SQL injection
# and safer than string formatting

# Request -> Validation -> Model Inference -> Store in DB -> Respond

# Client -> FastAPI -> Validation -> ML Model -> SQLite DB -> Response 

# SQLite by default only allows the connection to be used in the same thread it was created in. So if we don't write check same thread is false, it would throw an error 

# Commit = Make the change permanent

# API -> Service -> DB -> Model 

# DB Per Request
# A database connection per request and close it after request finishes

